# Architecture Crew - System Design & Specifications

This is the **Architecture Crew** - the second of three crews in the plugin development pipeline. It takes strategy outputs and creates detailed system architecture and specifications.

## Quick Start

### First Time Setup

```bash
cd architecture_crew
./setup_symlinks.sh    # Creates symlink to shared outputs
uv run crewai run
```

### Regular Usage

```bash
cd architecture_crew
uv run crewai run
```

⚠️ **Important:** Always run from the `architecture_crew` directory!

## Purpose

The Architecture Crew transforms strategy into actionable design by creating:
- **High-level system architecture**: Component boundaries, data flow, security layers
- **Complete folder structure**: JSON file with every folder and file to create
- **Backend specifications**: Detailed specs for each PHP class (methods, dependencies, security, tests)
- **Frontend specifications**: Detailed specs for each React component (props, state, hooks, tests)
- **Database schema**: Table designs with indexes and relationships
- **API contracts**: REST endpoint specifications

## Agent

**Software Architect** (1 agent)
- Role: WordPress Plugin System Designer
- LLM: `ollama/qwen3-coder:30b` (specialized for code architecture)
- Tools: FileReaderTool, DirectoryListTool, FindFilesTool
- Purpose: Design modular, SOLID-compliant architecture based on skeleton plugin conventions

## Tasks (5 Sequential)

1. **read_strategy_outputs** → Synthesize all strategy inputs
2. **design_high_level_architecture** → Create system overview
3. **define_folder_structure** → Generate folder-structure.json
4. **create_backend_specs** → Generate class specifications
5. **create_frontend_specs** → Generate component specifications

## Input Requirements

### From Strategy Crew
```
inputs/strategy-outputs/
├── technical-analysis.md      # Competitor analysis
├── market-research.md          # Market gaps & opportunities
├── product-roadmap.md          # Milestone-based roadmap
└── plugin-metadata.json        # Plugin name, slug, namespace (NEW!)
```

**Important:** plugin-metadata.json is generated by Strategy Crew's `create_roadmap` task.

### From Dev-Team Root
```
inputs/skeleton-plugin/         # Symlink to ../../inputs/skeleton-plugin
```

## Output Structure

```
outputs/
├── strategy-summary.md              # Synthesized requirements
├── high-level-architecture.md       # System design overview
├── database-schema.md               # Database tables & relationships
├── api-contracts.md                 # REST API specifications
├── folder-structure.json            # Complete file tree (KEY OUTPUT)
└── specs/
    ├── backend/                     # PHP class specifications
    │   ├── class-core.md
    │   ├── class-soap-client.md
    │   ├── class-voucher-manager.md
    │   ├── class-ajax-handler.md
    │   └── ... (8-12 specs)
    └── frontend/                    # React component specifications
        ├── component-voucher-form.md
        ├── component-tracking-display.md
        ├── component-settings-page.md
        └── ... (5-8 specs)
```

## Key Output: folder-structure.json

This JSON file is the "blueprint" for the Development Crew. It lists:
- Plugin root folder name (from slug)
- All folders to create
- All files to create with:
  - Path (relative to plugin root)
  - Type (bootstrap, php-class, react-component, asset, test)
  - Purpose (what the file does)
  - Spec file (which specification document describes it)

Example:
```json
{
  "plugin_root": "secure-elta-shipping",
  "plugin_metadata": {
    "name": "Secure ELTA Shipping Manager",
    "slug": "secure-elta-shipping",
    "namespace": "SecureELTA",
    "version": "1.0.0"
  },
  "files": [
    {
      "path": "includes/class-voucher-manager.php",
      "type": "php-class",
      "purpose": "Voucher CRUD operations and business logic",
      "spec_file": "specs/backend/class-voucher-manager.md"
    }
  ]
}
```

## Setup

### Prerequisites
- Python 3.10+
- Ollama running with `qwen3-coder:30b` model
- Strategy crew outputs copied to `inputs/strategy-outputs/`

### Installation

From the `architecture_crew` directory:

```bash
# Install dependencies
uv pip install -e .
# Or: pip install -e .
```

### Input Setup

1. **Copy strategy outputs:**
```bash
# Ensure strategy crew has run and generated outputs including plugin-metadata.json
cp ../strategy_crew/outputs/*.md inputs/strategy-outputs/
cp ../strategy_crew/outputs/*.json inputs/strategy-outputs/
```

2. **Verify symlink exists:**
```bash
ls -la inputs/skeleton-plugin
# Should point to: ../../inputs/skeleton-plugin
```

If symlink doesn't exist:
```bash
cd inputs
ln -s ../../inputs/skeleton-plugin skeleton-plugin
```

## Usage

### Run Architecture Design

From the `architecture_crew` directory:

```bash
crewai run
```

This will:
1. Read all strategy outputs (15-20 min per task = ~1-1.5 hours total)
2. Analyze skeleton plugin structure
3. Design high-level architecture
4. Generate complete folder structure
5. Create 8-12 backend class specifications
6. Create 5-8 frontend component specifications

**Expected Runtime:** 60-90 minutes (5 tasks, each 12-20 minutes)

### Check Outputs

```bash
ls -la outputs/
cat outputs/high-level-architecture.md
cat outputs/folder-structure.json | python -m json.tool  # Validate JSON
ls outputs/specs/backend/
ls outputs/specs/frontend/
```

## Validation

Before passing to Development Crew, verify:

1. **folder-structure.json is valid JSON**
   ```bash
   python -m json.tool outputs/folder-structure.json
   ```

2. **All spec files referenced exist**
   ```bash
   # Check that each spec_file in folder-structure.json exists
   ```

3. **Backend specs are detailed**
   - Each class has complete method signatures
   - Security requirements specified
   - Test requirements included

4. **Frontend specs are detailed**
   - Each component has props defined
   - State management specified
   - API integration detailed

## Configuration

### Models

The Software Architect uses:
- LLM: `ollama/qwen3-coder:30b` (specialized for code architecture)
- Temperature: Default (from agents.yaml)
- Tools: FileReaderTool, DirectoryListTool, FindFilesTool

### Tasks

Tasks are configured in `config/tasks.yaml`:
- Each task has context from previous tasks
- Sequential execution ensures proper information flow
- Output files are specified per task

## Integration with Other Crews

```
Strategy Crew → Architecture Crew → Development Crew
     ↓               ↓                     ↓
  outputs/      folder-structure    implemented code
                     .json
```

**Data Flow:**
1. Strategy defines **WHAT** to build
2. Architecture defines **HOW** to structure it
3. Development implements **THE CODE**

## Troubleshooting

### Error: "Strategy outputs not found"
```bash
# Copy strategy outputs
cp ../strategy_crew/outputs/*.md inputs/strategy-outputs/
cp ../strategy_crew/outputs/*.json inputs/strategy-outputs/
```

### Error: "Skeleton plugin not found"
```bash
# Recreate symlink
cd inputs
ln -s ../../inputs/skeleton-plugin skeleton-plugin
```

### Error: "plugin-metadata.json missing"
The Strategy Crew's `create_roadmap` task must generate this file. Run strategy crew first:
```bash
cd ../strategy_crew
crewai run
```

### Invalid JSON in folder-structure.json
The Software Architect should generate valid JSON. If not:
- Check LLM is generating proper JSON format
- Validate with: `python -m json.tool outputs/folder-structure.json`

## Next Steps

After Architecture Crew completes:

1. **Review outputs** - Check all specs are detailed and actionable
2. **Validate JSON** - Ensure folder-structure.json is valid
3. **Pass to Development Crew** - Copy outputs to development crew inputs:
   ```bash
   cp -r outputs/* ../development_crew/inputs/architecture-outputs/
   ```

## Expected Quality

Architecture outputs should be so detailed that:
- Developers can implement classes without asking questions
- Security requirements are clear and specific
- Test requirements are comprehensive
- All specs follow skeleton plugin conventions
- Every file to create is listed in folder-structure.json

---

**Created**: December 17, 2024  
**Status**: Ready for use (pending Strategy Crew updates)  
**Next**: Run Strategy Crew to generate plugin-metadata.json, then run Architecture Crew

